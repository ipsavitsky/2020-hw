# ПРОСТОЙ КАЛЬКУЛЯТОР

Простой интерактивный калькулятор

## Сборка

`make` - обычная сборка, без дебаг-информации, санитайзеров и покрытия кода

## Программный интерфейс

- `stack.h`
  Простая библиотека для работы со стеком.

Сам стек в данном случае представляет собой массив void\*, в котором укладываются элементы форматом

`|данные1|размер данных1|данные2|размер данных2...`

Обратный порядок выбран для того чтобы для операции pop() не проходиться по всему стеку с начала

### `RPN.h`

Простая библиотека для обработки польской инверсной записи

Сам полиз в данном случае тоже массив void\*, в котором данные укладываются следующим образом

`|размер данных1|функция обработки данных1|данные1|размер данных2|функция обработки данных2|данные2`

Заметим, что в случае закладывания в полиз функции, данных с ней может не идти

Немного о выравнивании:

Размер и функция должны быть выровнены так как их выравнивает структура

```c
struct input_data {
       Size_elem size;
       Calculate_elem f;
};
```

а данные должны быть выровнены вручную. В size хранится размер Calculate_elem+размер данных С УЧЕТОМ выравнивания(зачем там Calculate_elem - сам не знаю, стоит убрать чтобы его там не было).

### `arithm_func.h`

Содержит в себе арифметические функции, ИСПОЛЬЗУЕМЫЕ КАЛЬКУЛЯТОРОМ(и только калькулятором)
Все функции тут - типа `Calculate_elem`. Созданы только для того чтобы потом быть использованы стековой машиной для вычисления полиза.

### `rec_desc.h`

Рекурсивный спуск, преобразующий инфексную запись, воспринимаемую человеком, в постфиксную, воспринимаемую полизом, реализованным в `RPN.h`

Обрабатывает 4 стандартные арифметические операции, скобки и унарный минус.
В спорных моментах обычно консультировался с тем, как обрабатывает выражения си.
Например, запись `3 - -7` неверная, а вот `3 - (-7)` - верная. Калькулятор игнорирует пробелы(как и другие вайтспейсы, например `\t`).

### `errors.h`

Ничего особо интересного, только енум возможных ошибок + функция преобразования ошибки в текст

## Пользовательский интерфейс

### `calculator.c`

Простейший repl интерфейс для этого калькулятора.

Может 2 вещи:

1. добавлять переменные
2. вычислять выражения

Если в выражении есть символ `=`, то это инициализация новой переменной. ВСЕ что стоит до равно становится именем переменной(это не костыль, это синтаксис такой!). Правая часть этого выражения обрабатывается рекурсивным спуском и подсчитывается. Например, такая последовательность команд корректна
```
>>> a= 122
>>> b= a-5
a = 122.000000
122.000000 - 5.000000 = 117.000000
```
Таким образом, в b будет лежать 117.(после а и b не стоит пробелов, потому что = стоит всегда на конце имени перемнной).

(ВАЖНО!) `q`(как единичный символ) зарезервирован для выхода из калькулятора. Теоретически, завести переменную `q` можно, но тогда выводить ее в выражении ИЛИ написать `q(пробел)`(опять же, это НЕ! костыль)

Если написать прсто выражение без знака равно, то это выражение вычислится и его результат выведется в виде `result = (число)`, напрмер
```
>>> kak= 56
>>> zhe= 123.32
>>> kruto= .001
>>> 0.001 * kak + zhe * kruto
kak = 56.000000
0.001000 * 56.000000 = 0.056000
zhe = 123.320000
kruto = 0.001000
123.320000 * 0.001000 = 0.123320
0.056000 + 0.123320 = 0.179320
result = 0.179320
>>> q
```

В случае какой-либо ошибки в выражении, будет выводиться сообщение об ошибке
```
>>> hello=123
>>> privet + 15
Error: unknown variable
result = 0.000000
>>> 
```